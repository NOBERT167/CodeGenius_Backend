var Add{{ page_name }}Line = function () {
    var docNo = '@Model.{{ primary_key.csharp_name if primary_key else 'No' }}';
    $("#labelF").text("New {{ page_name }} Line");
    ShowProgress();
    $.ajax({
        async: true,
        type: "GET",
        dataType: "html",
        url: '/{{ parent_entity }}/New{{ page_name }}Line',
        data: { docNo: docNo },
        success: function (data) {
            $("#modalBody").html(data);
            HideProgress();
            $("#myModal").modal("show");
        },
        error: function (err) {
            HideProgress();
            Swal.fire('Warning', err.responseText, 'warning');
        }
    });
};

function Submit{{ page_name }}Line() {
    var isValid = true;{% for param in parameters %}{% if param.is_required and param.name.lower() != 'docno' and param.name.lower() != 'userid' and param.name.lower() != 'lineno' %}
    var {{ param.name }} = $("#{{ param.name }}").val();
    if (!{{ param.name }}) {
        Swal.fire('Warning', 'Please provide {{ param.display_name }}', 'warning');
        isValid = false;
        return;
    }{% endif %}{% endfor %}

    if (!isValid) return;

    var {{ page_name|lower }}Line = {
        No: '{% if primary_key %}@Model.{{ primary_key.csharp_name }}{% else %}@Model.No{% endif %}',{% for param in parameters %}{% if param.name.lower() != 'docno' and param.name.lower() != 'userid' and param.name.lower() != 'lineno' %}
        {{ param.csharp_name }}: {% if param.type == 'DateTime' %}$("#{{ param.name }}").val(){% else %}{% if param.type == 'int' or param.type == 'decimal' %}parseFloat($("#{{ param.name }}").val()){% else %}$("#{{ param.name }}").val(){% endif %}{% endif %}{% if not loop.last %},{% endif %}{% endif %}{% endfor %}
    };

    console.log({{ page_name|lower }}Line);

    ShowProgress();
    $.ajax({
        type: "POST",
        url: "/{{ parent_entity }}/Submit{{ page_name }}Line",
        data: JSON.stringify({{ page_name|lower }}Line),
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function (data) {
            HideProgress();
            if (data.success) {
                $("#myModal").modal("hide");
                Swal.fire('Success', data.message, 'success');
                Load{{ page_name }}Lines('{% if primary_key %}@Model.{{ primary_key.csharp_name }}{% else %}@Model.No{% endif %}', '@Model.Status');
            } else {
                Swal.fire('Warning', data.message, 'warning');
            }
        },
        error: function (err) {
            HideProgress();
            Swal.fire('Warning', err.responseText, 'warning');
        }
    });
}

function Delete{{ page_name }}Line(entryNo) {
    Swal.fire({
        title: 'Are you sure?',
        text: "You won't be able to revert this!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, delete it!'
    }).then((result) => {
        if (result.isConfirmed) {
            var docNo = '{% if primary_key %}@Model.{{ primary_key.csharp_name }}{% else %}@Model.No{% endif %}';
            ShowProgress();
            $.ajax({
                type: "POST",
                url: "/{{ parent_entity }}/Delete{{ page_name }}Line",
                data: JSON.stringify({ code: docNo, lineNo: entryNo }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    HideProgress();
                    if (data.success) {
                        $("#myModal").modal("hide");
                        Swal.fire('Success', data.message, 'success');
                        Load{{ page_name }}Lines('{% if primary_key %}@Model.{{ primary_key.csharp_name }}{% else %}@Model.No{% endif %}', '@Model.Status');
                    } else {
                        Swal.fire('Warning', data.message, 'warning');
                    }
                },
                error: function (err) {
                    HideProgress();
                    Swal.fire('Warning', err.responseText, 'warning');
                }
            });
        }
    });
}